# AI 零代码应用生成平台 - 项目架构文档

## 1. 项目概述

AI 零代码应用生成平台是一个基于 AI 技术的智能代码生成系统，用户可以通过自然语言描述需求，AI 自动生成相应的代码文件和应用。项目采用前后端分离架构，后端基于 Spring Boot 3 + LangChain4j，前端基于 Vue 3 + Ant Design Vue。

## 2. 整体架构

### 2.1 系统架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用      │    │   后端服务      │    │   外部服务      │
│  (Vue 3)       │◄──►│  (Spring Boot)  │◄──►│  (AI 模型)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户界面      │    │   业务逻辑      │    │   数据库        │
│   组件库        │    │   AI 工作流     │    │   (MySQL)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   状态管理      │    │   工具调用      │    │   缓存          │
│   (Pinia)       │    │   代码生成      │    │   (Redis)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 2.2 核心模块

- **AI 代码生成模块**: 基于 LangChain4j 和 LangGraph4j 的智能代码生成
- **工作流引擎**: 支持复杂的 AI 工作流编排
- **代码解析与保存**: 智能解析 AI 生成的代码并保存到文件系统
- **应用管理**: 用户应用的生命周期管理
- **部署服务**: 一键部署应用到云端
- **监控系统**: AI 模型性能和应用状态监控

## 3. 后端架构

### 3.1 技术栈

- **框架**: Spring Boot 3.5.4
- **Java 版本**: 21
- **AI 框架**: LangChain4j 1.1.0 + LangGraph4j 1.6.0
- **数据库**: MySQL + MyBatis-Flex
- **缓存**: Redis + Caffeine
- **消息队列**: 响应式编程 (Reactor)
- **安全**: Spring Session + Redis
- **限流**: Redisson 分布式限流

### 3.2 包结构

```
src/main/java/com/yupi/yuaicodemother/
├── ai/                          # AI 服务层
│   ├── AiCodeGeneratorService.java      # AI 代码生成服务
│   ├── AiCodeGeneratorServiceFactory.java # 服务工厂
│   ├── guardrail/              # 安全护栏
│   ├── model/                  # AI 模型相关
│   └── tools/                  # AI 工具
├── core/                       # 核心业务层
│   ├── AiCodeGeneratorFacade.java      # 代码生成门面
│   ├── builder/                # 项目构建器
│   ├── parser/                 # 代码解析器
│   └── saver/                  # 代码保存器
├── langgraph4j/                # 工作流引擎
│   ├── CodeGenWorkflow.java            # 代码生成工作流
│   ├── node/                   # 工作流节点
│   ├── state/                  # 工作流状态
│   └── tools/                  # 工作流工具
├── controller/                  # 控制器层
├── service/                     # 业务服务层
├── mapper/                      # 数据访问层
├── model/                       # 数据模型
├── config/                      # 配置类
└── utils/                       # 工具类
```

### 3.3 核心架构设计

#### 3.3.1 AI 代码生成架构

```
用户请求 → 路由服务 → AI 服务工厂 → 具体 AI 服务 → 代码生成 → 代码解析 → 文件保存
    ↓           ↓           ↓           ↓           ↓         ↓         ↓
  限流检查   类型识别    服务选择    模型调用    结果处理   语法检查   本地存储
```

#### 3.3.2 工作流引擎架构

```
LangGraph4j 工作流
├── ImageCollectorNode      # 图片收集节点
├── PromptEnhancerNode      # 提示词增强节点
├── RouterNode              # 路由节点
├── CodeGeneratorNode       # 代码生成节点
├── CodeQualityCheckNode    # 代码质量检查节点
└── ProjectBuilderNode      # 项目构建节点
```

#### 3.3.3 分层架构

- **表现层 (Controller)**: 处理 HTTP 请求，参数校验，权限控制
- **业务层 (Service)**: 业务逻辑处理，事务管理
- **AI 层 (AI Service)**: AI 模型调用，代码生成逻辑
- **工作流层 (LangGraph4j)**: 复杂 AI 工作流编排
- **数据层 (Mapper)**: 数据持久化，数据库操作
- **工具层 (Utils)**: 通用工具类，辅助功能

### 3.4 设计模式

- **工厂模式**: `AiCodeGeneratorServiceFactory` 根据类型创建不同的 AI 服务
- **门面模式**: `AiCodeGeneratorFacade` 统一代码生成的入口
- **策略模式**: 不同类型的代码生成采用不同的策略
- **模板方法模式**: `CodeFileSaverTemplate` 定义代码保存的模板
- **观察者模式**: 监控系统监听 AI 服务状态变化

## 4. 前端架构

### 4.1 技术栈

- **框架**: Vue 3.5.17 + TypeScript
- **构建工具**: Vite 7.0
- **UI 组件库**: Ant Design Vue 4.2.6
- **状态管理**: Pinia 3.0.3
- **路由**: Vue Router 4.5.1
- **HTTP 客户端**: Axios 1.11.0
- **代码高亮**: Highlight.js 11.11.1
- **Markdown 渲染**: Markdown-it 14.1.0

### 4.2 项目结构

```
yu-ai-code-mother-frontend/
├── src/
│   ├── components/           # 通用组件
│   │   ├── AppCard.vue              # 应用卡片
│   │   ├── AppDetailModal.vue       # 应用详情弹窗
│   │   ├── DeploySuccessModal.vue   # 部署成功弹窗
│   │   └── MarkdownRenderer.vue     # Markdown 渲染器
│   ├── pages/                # 页面组件
│   │   ├── admin/            # 管理员页面
│   │   ├── app/              # 应用相关页面
│   │   ├── user/             # 用户相关页面
│   │   └── HomePage.vue      # 首页
│   ├── layouts/              # 布局组件
│   │   └── BasicLayout.vue   # 基础布局
│   ├── stores/               # 状态管理
│   │   └── loginUser.ts      # 用户登录状态
│   ├── router/               # 路由配置
│   ├── api/                  # API 接口
│   ├── utils/                # 工具函数
│   └── config/               # 配置文件
├── public/                   # 静态资源
└── package.json              # 依赖配置
```

### 4.3 核心架构设计

#### 4.3.1 组件架构

- **原子组件**: 基础 UI 组件 (按钮、输入框等)
- **分子组件**: 功能组件 (应用卡片、弹窗等)
- **页面组件**: 完整页面 (聊天页面、管理页面等)
- **布局组件**: 页面布局结构

#### 4.3.2 状态管理架构

```
Pinia Store
├── loginUser.ts              # 用户登录状态
│   ├── loginUser             # 当前登录用户信息
│   ├── setLoginUser()        # 设置登录用户
│   └── logout()              # 用户登出
└── 其他业务状态...
```

#### 4.3.3 路由架构

```
路由结构
├── /                         # 首页
├── /user/login              # 用户登录
├── /user/register           # 用户注册
├── /app/chat/:id            # 应用聊天页面
├── /app/edit/:id            # 应用编辑页面
├── /admin/apps              # 应用管理
├── /admin/users             # 用户管理
└── /admin/chat              # 聊天管理
```

### 4.4 核心功能模块

#### 4.4.1 AI 聊天模块

- **实时对话**: 基于 SSE 的流式响应
- **代码生成**: AI 根据用户需求生成代码
- **可视化编辑**: 实时预览和编辑生成的代码
- **元素选择**: 支持选择页面元素进行修改

#### 4.4.2 应用管理模块

- **应用创建**: 支持多种代码生成类型
- **应用编辑**: 可视化编辑器
- **应用部署**: 一键部署到云端
- **代码下载**: 完整项目源码下载

#### 4.4.3 管理后台模块

- **用户管理**: 用户信息、权限管理
- **应用管理**: 应用审核、精选应用
- **系统监控**: AI 调用统计、性能监控
- **数据统计**: 业务指标分析

## 5. 数据架构

### 5.1 数据库设计

#### 5.1.1 核心表结构

- **user**: 用户信息表
- **app**: 应用信息表
- **chat_history**: 聊天历史表
- **app_deploy**: 应用部署记录表

#### 5.1.2 数据关系

```
用户 (User) ←→ 应用 (App) ←→ 聊天历史 (ChatHistory)
    ↓              ↓              ↓
用户角色        应用类型        消息类型
用户状态        应用状态        对话内容
```

### 5.2 缓存策略

- **多级缓存**: Redis + Caffeine 本地缓存
- **缓存策略**: 热点数据缓存，过期时间管理
- **缓存更新**: 写操作时主动更新缓存

## 6. 部署架构

### 6.1 部署方式

- **后端**: Spring Boot 内嵌 Tomcat
- **前端**: Nginx 静态文件服务
- **数据库**: MySQL 独立部署
- **缓存**: Redis 独立部署

### 6.2 环境配置

- **开发环境**: 本地开发配置
- **测试环境**: 测试服务器配置
- **生产环境**: 生产服务器配置

## 7. 安全架构

### 7.1 认证授权

- **Session 管理**: 基于 Redis 的分布式 Session
- **权限控制**: 注解式权限校验
- **用户角色**: 普通用户、管理员角色

### 7.2 安全防护

- **限流保护**: 基于 Redisson 的分布式限流
- **输入验证**: 参数校验、SQL 注入防护
- **CORS 配置**: 跨域请求控制

## 8. 监控架构

### 8.1 系统监控

- **应用监控**: Spring Boot Actuator
- **性能监控**: 响应时间、吞吐量统计
- **错误监控**: 异常日志收集

### 8.2 AI 服务监控

- **模型调用统计**: 调用次数、成功率
- **响应时间监控**: 模型响应时间统计
- **成本监控**: API 调用成本统计

## 9. 扩展性设计

### 9.1 水平扩展

- **无状态设计**: 支持多实例部署
- **负载均衡**: 支持负载均衡器分发
- **数据库分库分表**: 支持数据水平拆分

### 9.2 功能扩展

- **插件化架构**: 支持 AI 工具插件扩展
- **工作流扩展**: 支持自定义工作流节点
- **代码生成器扩展**: 支持新的代码生成类型

## 10. 总结

本项目采用现代化的微服务架构设计，前后端分离，后端基于 Spring Boot 3 + LangChain4j 构建 AI 服务，前端基于 Vue 3 + TypeScript 构建用户界面。整体架构具有良好的可扩展性、可维护性和性能表现，能够支持企业级的 AI 代码生成服务。
