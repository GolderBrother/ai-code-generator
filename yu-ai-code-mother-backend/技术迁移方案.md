# AI é›¶ä»£ç åº”ç”¨ç”Ÿæˆå¹³å° - Java åˆ° NestJS æŠ€æœ¯è¿ç§»æ–¹æ¡ˆ

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°†åç«¯ä» Java + Spring Boot è¿ç§»åˆ° Node.js + NestJS + TypeScript çš„æŠ€æœ¯æ–¹æ¡ˆã€‚

## ğŸ“‹ ç›®å½•

1. [è¿ç§»èƒŒæ™¯ä¸ç›®æ ‡](#1-è¿ç§»èƒŒæ™¯ä¸ç›®æ ‡)
2. [æŠ€æœ¯æ ˆå¯¹æ¯”åˆ†æ](#2-æŠ€æœ¯æ ˆå¯¹æ¯”åˆ†æ)
3. [æ¶æ„è¿ç§»æ–¹æ¡ˆ](#3-æ¶æ„è¿ç§»æ–¹æ¡ˆ)
4. [æ ¸å¿ƒåŠŸèƒ½è¿ç§»](#4-æ ¸å¿ƒåŠŸèƒ½è¿ç§»)
5. [æ•°æ®å±‚è¿ç§»](#5-æ•°æ®å±‚è¿ç§»)
6. [AI æœåŠ¡è¿ç§»](#6-ai-æœåŠ¡è¿ç§»)
7. [éƒ¨ç½²ä¸è¿ç»´](#7-éƒ¨ç½²ä¸è¿ç»´)
8. [è¿ç§»æ­¥éª¤ä¸æ—¶é—´è§„åˆ’](#8-è¿ç§»æ­¥éª¤ä¸æ—¶é—´è§„åˆ’)
9. [é£é™©è¯„ä¼°ä¸åº”å¯¹](#9-é£é™©è¯„ä¼°ä¸åº”å¯¹)
10. [æ€»ç»“](#10-æ€»ç»“)

## 1. è¿ç§»èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 è¿ç§»åŸå› 

**æŠ€æœ¯æ ˆç»Ÿä¸€**
- å‰åç«¯éƒ½ä½¿ç”¨ TypeScriptï¼Œå‡å°‘è¯­è¨€åˆ‡æ¢æˆæœ¬
- ç»Ÿä¸€çš„å¼€å‘ä½“éªŒå’Œå·¥å…·é“¾
- æ›´å¥½çš„ä»£ç å¤ç”¨å’Œç±»å‹å®‰å…¨

**å¼€å‘æ•ˆç‡æå‡**
- Node.js ç”Ÿæ€ä¸°å¯Œï¼Œå¼€å‘æ•ˆç‡é«˜
- TypeScript æä¾›æ›´å¥½çš„ç±»å‹å®‰å…¨
- å‰åç«¯ä»£ç å¯ä»¥å…±äº«ç±»å‹å®šä¹‰

**å›¢é˜ŸæŠ€èƒ½åŒ¹é…**
- å‰ç«¯å¼€å‘è€…æ›´å®¹æ˜“ä¸Šæ‰‹åç«¯å¼€å‘
- å‡å°‘å­¦ä¹ æˆæœ¬ï¼Œæé«˜å›¢é˜Ÿåä½œæ•ˆç‡

### 1.2 è¿ç§»ç›®æ ‡

**åŠŸèƒ½ä¿æŒ**
- ä¿æŒæ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¸å˜
- ä¿æŒ API æ¥å£å…¼å®¹æ€§
- ä¿æŒæ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘

**æ€§èƒ½æå‡**
- åˆ©ç”¨ Node.js å¼‚æ­¥éé˜»å¡ç‰¹æ€§
- ä¼˜åŒ– AI æœåŠ¡çš„å¹¶å‘å¤„ç†
- æå‡æ•´ä½“ç³»ç»Ÿå“åº”é€Ÿåº¦

**æ¶æ„ä¼˜åŒ–**
- é‡‡ç”¨ NestJS çš„æ¨¡å—åŒ–æ¶æ„
- æ›´å¥½çš„ä¾èµ–æ³¨å…¥å’ŒæœåŠ¡ç®¡ç†
- æ”¯æŒå¾®æœåŠ¡æ¶æ„æ‰©å±•

## 2. æŠ€æœ¯æ ˆå¯¹æ¯”åˆ†æ

### 2.1 åŸæŠ€æœ¯æ ˆï¼ˆJavaï¼‰

```
åç«¯æŠ€æœ¯æ ˆ
â”œâ”€â”€ æ ¸å¿ƒæ¡†æ¶: Spring Boot 3.5.4 + Java 21
â”œâ”€â”€ AI æ¡†æ¶: LangChain4j 1.1.0 + LangGraph4j 1.6.0
â”œâ”€â”€ æ•°æ®åº“: MySQL + MyBatis-Flex
â”œâ”€â”€ ç¼“å­˜: Redis + Caffeine
â”œâ”€â”€ æ¶ˆæ¯: Reactor (å“åº”å¼ç¼–ç¨‹)
â”œâ”€â”€ å®‰å…¨: Spring Session + Redisson
â””â”€â”€ ç›‘æ§: Spring Boot Actuator + Prometheus
```

### 2.2 æ–°æŠ€æœ¯æ ˆï¼ˆNode.jsï¼‰

```
åç«¯æŠ€æœ¯æ ˆ
â”œâ”€â”€ æ ¸å¿ƒæ¡†æ¶: NestJS 10 + Node.js 18+
â”œâ”€â”€ AI æ¡†æ¶: LangChain.js + LangGraph.js
â”œâ”€â”€ æ•°æ®åº“: MySQL + TypeORM/Prisma
â”œâ”€â”€ ç¼“å­˜: Redis + Node-Cache
â”œâ”€â”€ æ¶ˆæ¯: RxJS (å“åº”å¼ç¼–ç¨‹)
â”œâ”€â”€ å®‰å…¨: Passport + JWT + Redis
â””â”€â”€ ç›‘æ§: NestJS Terminus + Prometheus
```

### 2.3 æŠ€æœ¯æ ˆå¯¹æ¯”

| ç‰¹æ€§ | Java + Spring Boot | Node.js + NestJS |
|------|-------------------|------------------|
| **æ€§èƒ½** | é«˜å¹¶å‘ï¼Œå†…å­˜å ç”¨å¤§ | é«˜å¹¶å‘ï¼Œå†…å­˜å ç”¨å° |
| **å¼€å‘æ•ˆç‡** | ç¼–è¯‘å‹ï¼Œå¼€å‘å‘¨æœŸé•¿ | è§£é‡Šå‹ï¼Œå¼€å‘æ•ˆç‡é«˜ |
| **ç±»å‹å®‰å…¨** | å¼ºç±»å‹ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥ | TypeScriptï¼Œç¼–è¯‘æ—¶æ£€æŸ¥ |
| **ç”Ÿæ€** | ä¼ä¸šçº§ï¼Œæˆç†Ÿç¨³å®š | ä¸°å¯Œï¼Œæ›´æ–°å¿«é€Ÿ |
| **å­¦ä¹ æˆæœ¬** | è¾ƒé«˜ï¼Œæ¦‚å¿µå¤æ‚ | è¾ƒä½ï¼Œæ¦‚å¿µç®€å• |
| **éƒ¨ç½²** | JVMï¼Œèµ„æºæ¶ˆè€—å¤§ | è½»é‡çº§ï¼Œèµ„æºæ¶ˆè€—å° |

## 3. æ¶æ„è¿ç§»æ–¹æ¡ˆ

### 3.1 æ•´ä½“æ¶æ„å¯¹æ¯”

**åŸæ¶æ„ï¼ˆJavaï¼‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç°å±‚ (Controller)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡å±‚ (Service)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    AI æœåŠ¡å±‚ (AI Service)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  å·¥ä½œæµå±‚ (LangGraph4j)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å±‚ (Mapper)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚                               â”‚
â”‚              (Redis, MySQL, æ–‡ä»¶ç³»ç»Ÿç­‰)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–°æ¶æ„ï¼ˆNestJSï¼‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç°å±‚ (Controller)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡å±‚ (Service)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    AI æœåŠ¡å±‚ (AI Service)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  å·¥ä½œæµå±‚ (LangGraph.js)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å±‚ (Repository)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚                               â”‚
â”‚              (Redis, MySQL, æ–‡ä»¶ç³»ç»Ÿç­‰)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—åŒ–æ¶æ„è®¾è®¡

**NestJS æ¨¡å—ç»“æ„**:
```
src/
â”œâ”€â”€ app.module.ts                    # æ ¹æ¨¡å—
â”œâ”€â”€ main.ts                         # åº”ç”¨å…¥å£
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ auth/                       # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ users/                      # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ apps/                       # åº”ç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ apps.module.ts
â”‚   â”‚   â”œâ”€â”€ apps.controller.ts
â”‚   â”‚   â”œâ”€â”€ apps.service.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ ai/                         # AI æœåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ ai.module.ts
â”‚   â”‚   â”œâ”€â”€ ai.service.ts
â”‚   â”‚   â”œâ”€â”€ langchain/
â”‚   â”‚   â”œâ”€â”€ langgraph/
â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”œâ”€â”€ chat/                       # èŠå¤©æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ chat.module.ts
â”‚   â”‚   â”œâ”€â”€ chat.controller.ts
â”‚   â”‚   â”œâ”€â”€ chat.service.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â””â”€â”€ common/                     # å…¬å…±æ¨¡å—
â”‚       â”œâ”€â”€ common.module.ts
â”‚       â”œâ”€â”€ decorators/
â”‚       â”œâ”€â”€ filters/
â”‚       â”œâ”€â”€ guards/
â”‚       â”œâ”€â”€ interceptors/
â”‚       â””â”€â”€ pipes/
â”œâ”€â”€ config/                         # é…ç½®æ¨¡å—
â”œâ”€â”€ database/                       # æ•°æ®åº“æ¨¡å—
â””â”€â”€ utils/                          # å·¥å…·æ¨¡å—
```

### 3.3 ä¾èµ–æ³¨å…¥æ¶æ„

**NestJS ä¾èµ–æ³¨å…¥**:
```typescript
// æ¨¡å—å®šä¹‰
@Module({
  imports: [
    TypeOrmModule.forFeature([App, User, ChatHistory]),
    RedisModule,
    AiModule,
  ],
  controllers: [AppsController],
  providers: [AppsService, AppRepository],
  exports: [AppsService],
})
export class AppsModule {}

// æœåŠ¡æ³¨å…¥
@Injectable()
export class AppsService {
  constructor(
    @InjectRepository(App)
    private readonly appRepository: Repository<App>,
    private readonly aiService: AiService,
    private readonly redisService: RedisService,
  ) {}
}
```

## 4. æ ¸å¿ƒåŠŸèƒ½è¿ç§»

### 4.1 æ§åˆ¶å™¨å±‚è¿ç§»

**åŸ Java Controller**:
```java
@RestController
@RequestMapping("/app")
public class AppController {
    
    @GetMapping(value = "/chat/gen/code", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    @RateLimit(limitType = RateLimitType.USER, rate = 5, rateInterval = 60)
    public Flux<ServerSentEvent<String>> chatToGenCode(@RequestParam Long appId,
                                                       @RequestParam String message,
                                                       HttpServletRequest request) {
        // å®ç°é€»è¾‘
    }
}
```

**æ–° NestJS Controller**:
```typescript
@Controller('app')
export class AppsController {
  
  @Get('chat/gen/code')
  @Header('Content-Type', 'text/event-stream')
  @UseGuards(RateLimitGuard)
  @RateLimit({ limit: 5, ttl: 60000 })
  async chatToGenCode(
    @Query('appId') appId: number,
    @Query('message') message: string,
    @Req() request: Request,
    @Res() response: Response,
  ): Promise<void> {
    // å®ç°é€»è¾‘
  }
}
```

### 4.2 æœåŠ¡å±‚è¿ç§»

**åŸ Java Service**:
```java
@Service
public class AppServiceImpl implements AppService {
    
    @Override
    public Flux<String> chatToGenCode(Long appId, String message, User loginUser) {
        // å®ç°é€»è¾‘
    }
}
```

**æ–° NestJS Service**:
```typescript
@Injectable()
export class AppsService {
  
  async chatToGenCode(
    appId: number,
    message: string,
    loginUser: User,
  ): Promise<Observable<string>> {
    // å®ç°é€»è¾‘
  }
}
```

### 4.3 æ•°æ®è®¿é—®å±‚è¿ç§»

**åŸ Java Mapper**:
```java
@Mapper
public interface AppMapper extends BaseMapper<App> {
    
    @Select("SELECT * FROM app WHERE user_id = #{userId}")
    List<App> selectByUserId(@Param("userId") Long userId);
}
```

**æ–° NestJS Repository**:
```typescript
@EntityRepository(App)
export class AppRepository extends Repository<App> {
  
  async findByUserId(userId: number): Promise<App[]> {
    return this.createQueryBuilder('app')
      .where('app.userId = :userId', { userId })
      .getMany();
  }
}
```

## 5. æ•°æ®å±‚è¿ç§»

### 5.1 æ•°æ®åº“è¿æ¥é…ç½®

**åŸ Java é…ç½®**:
```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/yu_ai_code_mother
    username: root
    password: 123456
```

**æ–° NestJS é…ç½®**:
```typescript
// app.module.ts
@Module({
  imports: [
    TypeOrmModule.forRoot({
      type: 'mysql',
      host: 'localhost',
      port: 3306,
      username: 'root',
      password: '123456',
      database: 'yu_ai_code_mother',
      entities: [__dirname + '/**/*.entity{.ts,.js}'],
      synchronize: false,
      logging: true,
    }),
  ],
})
export class AppModule {}
```

### 5.2 å®ä½“å®šä¹‰è¿ç§»

**åŸ Java Entity**:
```java
@Data
@TableName("app")
public class App {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    @TableField("app_name")
    private String appName;
    
    @TableField("app_desc")
    private String appDesc;
    
    @TableField("user_id")
    private Long userId;
}
```

**æ–° NestJS Entity**:
```typescript
@Entity('app')
export class App {
  @PrimaryGeneratedColumn()
  id: number;
  
  @Column({ name: 'app_name', length: 128 })
  appName: string;
  
  @Column({ name: 'app_desc', type: 'text', nullable: true })
  appDesc: string;
  
  @Column({ name: 'user_id' })
  userId: number;
  
  @ManyToOne(() => User, user => user.apps)
  @JoinColumn({ name: 'user_id' })
  user: User;
}
```

### 5.3 ç¼“å­˜ç­–ç•¥è¿ç§»

**åŸ Java ç¼“å­˜**:
```java
@Cacheable(value = "app", key = "#appId")
public App getAppById(Long appId) {
    return appMapper.selectOneById(appId);
}
```

**æ–° NestJS ç¼“å­˜**:
```typescript
@Injectable()
export class AppsService {
  
  @CacheKey('app')
  @CacheTTL(600) // 10åˆ†é’Ÿ
  async getAppById(appId: number): Promise<App> {
    return this.appRepository.findOne({ where: { id: appId } });
  }
}
```

## 6. AI æœåŠ¡è¿ç§»

### 6.1 LangChain è¿ç§»

**åŸ Java LangChain4j**:
```java
@SystemMessage(fromResource = "prompt/codegen-html-system-prompt.txt")
HtmlCodeResult generateHtmlCode(String userMessage);
```

**æ–° Node.js LangChain.js**:
```typescript
import { ChatOpenAI } from '@langchain/openai';
import { PromptTemplate } from '@langchain/core/prompts';
import { loadSystemPrompt } from '../utils/prompt-loader';

@Injectable()
export class AiService {
  
  async generateHtmlCode(userMessage: string): Promise<HtmlCodeResult> {
    const systemPrompt = await loadSystemPrompt('codegen-html-system-prompt.txt');
    const prompt = PromptTemplate.fromTemplate(systemPrompt);
    
    const model = new ChatOpenAI({
      modelName: 'gpt-3.5-turbo',
      temperature: 0.7,
    });
    
    const chain = prompt.pipe(model);
    const response = await chain.invoke({ userMessage });
    
    return this.parseHtmlCodeResponse(response.content);
  }
}
```

### 6.2 å·¥ä½œæµå¼•æ“è¿ç§»

**åŸ Java LangGraph4j**:
```java
public class CodeGenWorkflow {
    
    public CompiledGraph<MessagesState<String>> createWorkflow() {
        return new MessagesStateGraph<String>()
                .addNode("image_collector", ImageCollectorNode.create())
                .addNode("prompt_enhancer", PromptEnhancerNode.create())
                .compile();
    }
}
```

**æ–° Node.js LangGraph.js**:
```typescript
import { StateGraph, END } from '@langchain/langgraph';

export class CodeGenWorkflow {
  
  createWorkflow(): StateGraph<any> {
    const workflow = new StateGraph({
      channels: {
        messages: {
          value: (x: any) => x.messages,
          default: () => [],
        },
      },
    });
    
    workflow.addNode('image_collector', this.imageCollectorNode);
    workflow.addNode('prompt_enhancer', this.promptEnhancerNode);
    
    workflow.addEdge('image_collector', 'prompt_enhancer');
    workflow.addEdge('prompt_enhancer', END);
    
    return workflow.compile();
  }
}
```

### 6.3 å·¥å…·è°ƒç”¨è¿ç§»

**åŸ Java å·¥å…·**:
```java
@Component
public class FileWriteTool implements BaseTool {
    
    @Override
    public Tool getTool() {
        return Tool.builder()
                .name("file_write")
                .description("Write content to a file")
                .inputSchema(JsonSchema.builder()
                        .type("object")
                        .properties(Map.of(
                                "file_path", JsonSchema.builder().type("string").build(),
                                "content", JsonSchema.builder().type("string").build()
                        ))
                        .required(List.of("file_path", "content"))
                        .build())
                .invocationHandler(this::invoke)
                .build();
    }
}
```

**æ–° Node.js å·¥å…·**:
```typescript
import { Tool } from '@langchain/core/tools';
import { z } from 'zod';

@Injectable()
export class FileWriteTool extends Tool {
  
  schema = z.object({
    file_path: z.string().describe('æ–‡ä»¶è·¯å¾„'),
    content: z.string().describe('æ–‡ä»¶å†…å®¹'),
  });
  
  name = 'file_write';
  description = 'å°†å†…å®¹å†™å…¥æ–‡ä»¶';
  
  async _call(input: z.infer<typeof this.schema>): Promise<string> {
    const { file_path, content } = input;
    
    try {
      await fs.writeFile(file_path, content, 'utf8');
      return `æ–‡ä»¶ ${file_path} å†™å…¥æˆåŠŸ`;
    } catch (error) {
      return `æ–‡ä»¶å†™å…¥å¤±è´¥: ${error.message}`;
    }
  }
}
```

## 7. éƒ¨ç½²ä¸è¿ç»´

### 7.1 å®¹å™¨åŒ–éƒ¨ç½²

**Dockerfile**:
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY dist ./dist
COPY node_modules ./node_modules

EXPOSE 3000

CMD ["node", "dist/main"]
```

**Docker Compose**:
```yaml
version: '3.8'
services:
  backend:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
  
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_DATABASE: yu_ai_code_mother
    volumes:
      - mysql_data:/var/lib/mysql
  
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

### 7.2 ç›‘æ§ä¸æ—¥å¿—

**å¥åº·æ£€æŸ¥**:
```typescript
import { TerminusModule } from '@nestjs/terminus';
import { HealthController } from './health.controller';

@Module({
  imports: [TerminusModule],
  controllers: [HealthController],
})
export class HealthModule {}

@Controller('health')
export class HealthController {
  @Get()
  @HealthCheck()
  check() {
    return this.health.check([
      () => this.db.pingCheck('database'),
      () => this.redis.pingCheck('redis'),
    ]);
  }
}
```

**æ—¥å¿—é…ç½®**:
```typescript
import { WinstonModule } from 'nest-winston';
import * as winston from 'winston';

const winstonConfig = WinstonModule.createLogger({
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.colorize(),
        winston.format.simple(),
      ),
    }),
    new winston.transports.File({
      filename: 'logs/error.log',
      level: 'error',
    }),
    new winston.transports.File({
      filename: 'logs/combined.log',
    }),
  ],
});
```

## 8. è¿ç§»æ­¥éª¤ä¸æ—¶é—´è§„åˆ’

### 8.1 è¿ç§»é˜¶æ®µ

**ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒæ­å»ºï¼ˆ1-2å¤©ï¼‰**
- æ­å»º NestJS å¼€å‘ç¯å¢ƒ
- é…ç½®æ•°æ®åº“è¿æ¥
- è®¾ç½®åŸºç¡€é¡¹ç›®ç»“æ„

**ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—è¿ç§»ï¼ˆ3-5å¤©ï¼‰**
- ç”¨æˆ·è®¤è¯æ¨¡å—
- åº”ç”¨ç®¡ç†æ¨¡å—
- åŸºç¡€ CRUD æ“ä½œ

**ç¬¬ä¸‰é˜¶æ®µï¼šAI æœåŠ¡è¿ç§»ï¼ˆ5-7å¤©ï¼‰**
- LangChain.js é›†æˆ
- å·¥ä½œæµå¼•æ“è¿ç§»
- å·¥å…·è°ƒç”¨å®ç°

**ç¬¬å››é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½è¿ç§»ï¼ˆ3-4å¤©ï¼‰**
- æµå¼å“åº”å®ç°
- ç¼“å­˜ç­–ç•¥
- ç›‘æ§ç³»ç»Ÿ

**ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰**
- åŠŸèƒ½æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- éƒ¨ç½²æµ‹è¯•

### 8.2 è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] é¡¹ç›®ç¯å¢ƒæ­å»º
- [ ] æ•°æ®åº“è¿æ¥é…ç½®
- [ ] åŸºç¡€æ¨¡å—è¿ç§»
- [ ] AI æœåŠ¡è¿ç§»
- [ ] å·¥å…·è°ƒç”¨è¿ç§»
- [ ] ç¼“å­˜ç­–ç•¥å®ç°
- [ ] å®‰å…¨æœºåˆ¶å®ç°
- [ ] ç›‘æ§ç³»ç»Ÿé…ç½®
- [ ] éƒ¨ç½²é…ç½®
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

## 9. é£é™©è¯„ä¼°ä¸åº”å¯¹

### 9.1 æŠ€æœ¯é£é™©

**é£é™©1ï¼šAI æ¡†æ¶å…¼å®¹æ€§**
- **é£é™©æè¿°**: LangChain.js å¯èƒ½ä¸åŸ Java ç‰ˆæœ¬åŠŸèƒ½ä¸å®Œå…¨ä¸€è‡´
- **åº”å¯¹ç­–ç•¥**: æå‰æµ‹è¯•å…³é”®åŠŸèƒ½ï¼Œå‡†å¤‡é™çº§æ–¹æ¡ˆ

**é£é™©2ï¼šæ€§èƒ½å·®å¼‚**
- **é£é™©æè¿°**: Node.js å•çº¿ç¨‹æ¨¡å‹å¯èƒ½å½±å“ CPU å¯†é›†å‹ä»»åŠ¡
- **åº”å¯¹ç­–ç•¥**: ä½¿ç”¨ Worker Threads å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡

**é£é™©3ï¼šç”Ÿæ€ç³»ç»Ÿå·®å¼‚**
- **é£é™©æè¿°**: Node.js ç”Ÿæ€ä¸­æŸäº›åº“å¯èƒ½ä¸å¦‚ Java æˆç†Ÿ
- **åº”å¯¹ç­–ç•¥**: é€‰æ‹©æˆç†Ÿç¨³å®šçš„åº“ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ

### 9.2 ä¸šåŠ¡é£é™©

**é£é™©1ï¼šåŠŸèƒ½ç¼ºå¤±**
- **é£é™©æè¿°**: è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½é—æ¼æŸäº›åŠŸèƒ½
- **åº”å¯¹ç­–ç•¥**: å»ºç«‹åŠŸèƒ½æ¸…å•ï¼Œé€é¡¹éªŒè¯

**é£é™©2ï¼šæ•°æ®ä¸€è‡´æ€§**
- **é£é™©æè¿°**: æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°ä¸ä¸€è‡´
- **åº”å¯¹ç­–ç•¥**: å»ºç«‹æ•°æ®éªŒè¯æœºåˆ¶ï¼Œå‡†å¤‡å›æ»šæ–¹æ¡ˆ

**é£é™©3ï¼šæœåŠ¡ä¸­æ–­**
- **é£é™©æè¿°**: è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°æœåŠ¡ä¸­æ–­
- **åº”å¯¹ç­–ç•¥**: é‡‡ç”¨è“ç»¿éƒ¨ç½²ï¼Œç¡®ä¿æœåŠ¡è¿ç»­æ€§

### 9.3 é£é™©ç¼“è§£æªæ–½

1. **æ¸è¿›å¼è¿ç§»**: é‡‡ç”¨æ¨¡å—åŒ–è¿ç§»ï¼Œé™ä½é£é™©
2. **å……åˆ†æµ‹è¯•**: å»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»
3. **å›æ»šæ–¹æ¡ˆ**: å‡†å¤‡å¿«é€Ÿå›æ»šåˆ°åŸç³»ç»Ÿçš„æ–¹æ¡ˆ
4. **ç›‘æ§å‘Šè­¦**: å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
5. **å›¢é˜ŸåŸ¹è®­**: ç¡®ä¿å›¢é˜ŸæŒæ¡æ–°æŠ€æœ¯æ ˆ

## 10. æ€»ç»“

### 10.1 è¿ç§»ä¼˜åŠ¿

1. **æŠ€æœ¯æ ˆç»Ÿä¸€**: å‰åç«¯éƒ½ä½¿ç”¨ TypeScriptï¼Œæé«˜å¼€å‘æ•ˆç‡
2. **æ€§èƒ½æå‡**: åˆ©ç”¨ Node.js å¼‚æ­¥éé˜»å¡ç‰¹æ€§
3. **å¼€å‘æ•ˆç‡**: å‡å°‘ç¼–è¯‘æ—¶é—´ï¼Œæé«˜å¼€å‘è¿­ä»£é€Ÿåº¦
4. **å›¢é˜Ÿåä½œ**: é™ä½å‰åç«¯åä½œæˆæœ¬
5. **ç”Ÿæ€ä¸°å¯Œ**: Node.js ç”Ÿæ€æ›´åŠ ä¸°å¯Œå’Œæ´»è·ƒ

### 10.2 è¿ç§»æŒ‘æˆ˜

1. **å­¦ä¹ æˆæœ¬**: å›¢é˜Ÿéœ€è¦å­¦ä¹  NestJS æ¡†æ¶
2. **åŠŸèƒ½è¿ç§»**: AI æœåŠ¡è¿ç§»å¤æ‚åº¦è¾ƒé«˜
3. **æ€§èƒ½è°ƒä¼˜**: éœ€è¦é‡æ–°ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
4. **æµ‹è¯•éªŒè¯**: éœ€è¦å»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»

### 10.3 æˆåŠŸå…³é”®å› ç´ 

1. **å……åˆ†å‡†å¤‡**: æå‰åšå¥½æŠ€æœ¯è°ƒç ”å’Œæ–¹æ¡ˆè®¾è®¡
2. **å›¢é˜ŸåŸ¹è®­**: ç¡®ä¿å›¢é˜ŸæŒæ¡æ–°æŠ€æœ¯æ ˆ
3. **æ¸è¿›è¿ç§»**: é‡‡ç”¨æ¨¡å—åŒ–è¿ç§»ç­–ç•¥
4. **å……åˆ†æµ‹è¯•**: å»ºç«‹å®Œå–„çš„æµ‹è¯•å’ŒéªŒè¯æœºåˆ¶
5. **é£é™©æ§åˆ¶**: å»ºç«‹å®Œå–„çš„é£é™©è¯„ä¼°å’Œåº”å¯¹æœºåˆ¶

é€šè¿‡åˆç†çš„è§„åˆ’å’Œæ‰§è¡Œï¼Œè¿™æ¬¡æŠ€æœ¯è¿ç§»å°†ä¸ºå›¢é˜Ÿå¸¦æ¥æ˜¾è‘—çš„æŠ€æœ¯æå‡å’Œå¼€å‘æ•ˆç‡æå‡ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šåšå®çš„åŸºç¡€ã€‚
